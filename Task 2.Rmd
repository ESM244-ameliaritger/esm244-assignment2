---
title: "Task 2"
author: "Amelia Ritger"
date: "2/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```

## Here's a useful and descriptive introductory summary! 
Curious where the data comes from? [Look no further!](http://www.cbr.washington.edu/dart/query/adult_graph_text)

## Here's an image of a steelhead or the Bonneville Dam!

## Now let's get into the code! 

Load necessary packages and data
```{r}
library(tidyverse)
library(janitor)
library(lubridate)
library(tsibble)
library(feasts)

raw_fish <- read_csv("cbr_fish_passage_bonneville_allyrs_steelhead.csv") %>% 
  clean_names()
```

Tidy the data
```{r}
fish <- raw_fish %>%
  drop_na(value) %>% #drop NA values
  filter(value>=0) %>% #drop negative values because metadata doesn't explain what they mean
  separate(mm_dd, into=c("day", "month")) %>%  #separate out month and day
  mutate(yr_mo_day = paste(year, match(month,month.abb), day, sep="-")) %>% #combine all date columns and separate by -
  mutate(yr_mo = paste(year, match(month,month.abb), sep="-")) %>% #combine all date columns and separate by -
  mutate(date = as.Date(yr_mo_day)) %>% #tell R this is a date
  mutate(year_month = tsibble::yearmonth(yr_mo_day)) %>% #tell R this is a date
  select("year", "year_month", "yr_mo", "date", "value") #remove unnecessary variables
```

### Look at the data day-by-day (original time series observations)
```{r}
fish_day <- ggplot(data=fish, aes(x=date, y=value)) +
  geom_line()

fish_day
```

Look at the data month-by-month
```{r}
fish_month <- ggplot(data=fish, aes(x=year_month, y=value)) +
  geom_line()

fish_month
```

Look at the data year-by-year
```{r}
fish_yr <- ggplot(data=fish, aes(x=year, y=value)) +
  geom_line()

fish_yr
```

### Make a season plot
```{r}
#Coerce dataframe to a tsibble
fish_ts <- as_tsibble(fish, index= year_month)

#plot tsibble fancy plots
fish_ts %>% autoplot(value)
fish_ts %>% gg_subseries(value)

#prep data frame for season plot
fish_summary <- fish %>% 
  group_by(yr_mo) %>%
  summarise(sums=sum(value)) %>% 
  mutate(year_month = tsibble::yearmonth(yr_mo)) %>% #tell R this is a date
  mutate(month = month(year_month, label = TRUE)) %>% 
  mutate(year = year(year_month))

#coerce data frame into a tsibble
fish_summary_ts <- as_tsibble(fish_summary, index= year_month) %>% 
  fill_gaps() #fill gaps because some dates didn't take measurements

#plot season plot
fish_summary_ts %>% gg_season(sums)

#make the same season plot but now in ggplot
ggplot(data=fish_summary, aes(x=month, y=sums, group=year)) +
  geom_line(aes(color=year))
```

Visualize annual steelhead passage counts
```{r}
#prep data frame for annual counts plot
fish_annual <- fish %>% 
  group_by(year) %>% 
  summarize(sums=sum(value))

#plot it
ggplot(data=fish_annual, aes(x=year, y=sums)) +
  geom_line()
```

